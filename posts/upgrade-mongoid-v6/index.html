<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.68.3"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/amzrk2/poal-jsdelivr@1.2.0/favicons/favicon.ico><title>Upgrade mongoid from v5.4.0 to v6.4.2 - mknkisk.log</title><meta name=author content><meta name=description content="Upgrading mongoid  v5.4.0 -> v6.4.2 refs: https://docs.mongodb.com/mongoid/6.4/tutorials/mongoid-upgrade/#upgrade-to-6-x-series  6.0.0.beta https://github.com/mongodb/mongoid/releases/tag/v6.0.0.beta
  MONGOID-3944 Support #create_with method.
 ğŸ†•#create_with ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ  ActiveRecord ã® #create_with ã® mongoid ç‰ˆ https://qiita.com/pekepek/items/c57d4859e6e1ec8b1ad1#1-create_with    MONGOID-4019, MONGOID-4182 Don&rsquo;t include Mongoi::Attributes::Dynamic when cloning documents with unknown attributes.
  MONGOID-4167 Raise an exception if Model#with is called with invalid driver options.
 #with ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ©ç”¨ã§ããªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚‹ âš ï¸ å¤ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã®ã§ä¿®æ­£ãŒå¿…è¦ -> with(safe: true)    MONGOID-4264 Require belongs_to by default and provide options to override requirement."><meta property="og:title" content="Upgrade mongoid from v5.4.0 to v6.4.2"><meta property="og:description" content="Upgrading mongoid  v5.4.0 -> v6.4.2 refs: https://docs.mongodb.com/mongoid/6.4/tutorials/mongoid-upgrade/#upgrade-to-6-x-series  6.0.0.beta https://github.com/mongodb/mongoid/releases/tag/v6.0.0.beta
  MONGOID-3944 Support #create_with method.
 ğŸ†•#create_with ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ  ActiveRecord ã® #create_with ã® mongoid ç‰ˆ https://qiita.com/pekepek/items/c57d4859e6e1ec8b1ad1#1-create_with    MONGOID-4019, MONGOID-4182 Don&rsquo;t include Mongoi::Attributes::Dynamic when cloning documents with unknown attributes.
  MONGOID-4167 Raise an exception if Model#with is called with invalid driver options.
 #with ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ©ç”¨ã§ããªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚‹ âš ï¸ å¤ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã®ã§ä¿®æ­£ãŒå¿…è¦ -> with(safe: true)    MONGOID-4264 Require belongs_to by default and provide options to override requirement."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mknkisk.com/posts/upgrade-mongoid-v6/"><meta property="article:published_time" content="2019-04-01T17:17:02+09:00"><meta property="article:modified_time" content="2019-04-01T17:17:02+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Upgrade mongoid from v5.4.0 to v6.4.2"><meta name=twitter:description content="Upgrading mongoid  v5.4.0 -> v6.4.2 refs: https://docs.mongodb.com/mongoid/6.4/tutorials/mongoid-upgrade/#upgrade-to-6-x-series  6.0.0.beta https://github.com/mongodb/mongoid/releases/tag/v6.0.0.beta
  MONGOID-3944 Support #create_with method.
 ğŸ†•#create_with ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ  ActiveRecord ã® #create_with ã® mongoid ç‰ˆ https://qiita.com/pekepek/items/c57d4859e6e1ec8b1ad1#1-create_with    MONGOID-4019, MONGOID-4182 Don&rsquo;t include Mongoi::Attributes::Dynamic when cloning documents with unknown attributes.
  MONGOID-4167 Raise an exception if Model#with is called with invalid driver options.
 #with ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ©ç”¨ã§ããªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚‹ âš ï¸ å¤ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã®ã§ä¿®æ­£ãŒå¿…è¦ -> with(safe: true)    MONGOID-4264 Require belongs_to by default and provide options to override requirement."><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-42113411-10','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=stylesheet href=https://blog.mknkisk.com/css/main.min.css><script src=https://blog.mknkisk.com/js/jquery.min.js></script><script src=https://blog.mknkisk.com/js/lazysizes.min.js></script><link rel=stylesheet href=https://blog.mknkisk.com/css/fontawsome.min.css><script src=https://blog.mknkisk.com/js/medium-zoom.min.js></script><body class="d-flex flex-column h-100"><header><div class="container-lg clearfix"><div class="col-12 link-primary"><a class=main-title href=https://blog.mknkisk.com/>mknkisk.log</a></div></div></header><main><div class="container-lg clearfix"><div class="col-md-9 col-12 float-left" id=content><article><h4 class=post-title><a href=https://blog.mknkisk.com/posts/upgrade-mongoid-v6/>Upgrade mongoid from v5.4.0 to v6.4.2</a></h4><div class="post-meta link-alter"><time><i class="fas fa-calendar-day"></i>&nbsp;2019-04-01</time><span><i class="fas fa-tag"></i>&nbsp;No tag</span></div><div class="post-content markdown-body"><h2 id=upgrading-mongoid>Upgrading mongoid</h2><ul><li>v5.4.0 -> v6.4.2</li><li>refs:
<a href=https://docs.mongodb.com/mongoid/6.4/tutorials/mongoid-upgrade/#upgrade-to-6-x-series>https://docs.mongodb.com/mongoid/6.4/tutorials/mongoid-upgrade/#upgrade-to-6-x-series</a></li></ul><h2 id=600beta>6.0.0.beta</h2><p><a href=https://github.com/mongodb/mongoid/releases/tag/v6.0.0.beta>https://github.com/mongodb/mongoid/releases/tag/v6.0.0.beta</a></p><ul><li><p><a href=https://jira.mongodb.org/browse/MONGOID-3944 target=_blank>MONGOID-3944</a> Support #create_with method.</p><ul><li>ğŸ†•#create_with ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ </li><li>ActiveRecord ã® #create_with ã® mongoid ç‰ˆ</li><li><a href=https://qiita.com/pekepek/items/c57d4859e6e1ec8b1ad1#1-create_with>https://qiita.com/pekepek/items/c57d4859e6e1ec8b1ad1#1-create_with</a></li></ul></li><li><p><a href=https://jira.mongodb.org/browse/MONGOID-4019 target=_blank>MONGOID-4019</a>, <a href=https://jira.mongodb.org/browse/MONGOID-4182 target=_blank>MONGOID-4182</a> Don&rsquo;t include
Mongoi::Attributes::Dynamic when cloning documents with unknown attributes.</p></li><li><p><a href=https://jira.mongodb.org/browse/MONGOID-4167 target=_blank>MONGOID-4167</a> Raise an exception if Model#with is called with invalid driver options.</p><ul><li><code>#with</code> ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ©ç”¨ã§ããªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚‹</li><li>âš ï¸
å¤ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã®ã§ä¿®æ­£ãŒå¿…è¦ -> <code>with(safe: true)</code></li></ul></li><li><p><a href=https://jira.mongodb.org/browse/MONGOID-4264 target=_blank>MONGOID-4264</a> Require belongs_to by default and provide options to override requirement.</p><ul><li>ActiveRecord ã® belongs_to_required_by_default ã® mongoid ç‰ˆ</li><li>âš ï¸ <code>belongs_to</code> å¯¾è±¡ã® id ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¿…é ˆãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«</li><li>ğŸ“ mongoid.yml ã® <code>belongs_to_required_by_default</code> ã®è¨­å®šã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å¤‰æ›´å¯èƒ½</li></ul></li><li><p><a href=https://jira.mongodb.org/browse/MONGOID-4193 target=_blank>MONGOID-4193</a> Override attributes in criteria&rsquo;s selector with write method&rsquo;s attributes.</p><ul><li><code>#first_or_initialize</code> ã‚„ <code>#find_or_create</code> ã®æŒ™å‹•ãŒ ActiveRecord ã¨ç•°ãªã‚‹ã®ãŒä¿®æ­£ã•ã‚ŒãŸ</li><li>:warning: qriteria (where etc) ã¨çµ„ã¿åˆã‚ã›ãŸã¨ãã«åˆæœŸå€¤ãŒ qriteria ã«ãªã£ã¦ã—ã¾ã†ã®ãŒä¿®æ­£ã•ã‚ŒãŸ</li></ul></li><li><p><a href=https://jira.mongodb.org/browse/MONGOID-4270 target=_blank>MONGOID-4270</a> Take out run_targeted_callbacks</p><ul><li>ActiveSupport 4.0 ã‚µãƒãƒ¼ãƒˆçµ‚äº†</li></ul></li><li><p><a href=https://jira.mongodb.org/browse/MONGOID-4239 target=_blank>MONGOID-4239 Validate field names.</a></p><ul><li>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã« mongoid ã®ãƒ¡ã‚½ãƒƒãƒ‰åã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚’ç¦æ­¢ã«</li><li>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãƒã‚§ãƒƒã‚¯ã¨ãã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå®Ÿè£…ã•ã‚ŒãŸ</li></ul></li></ul><h2 id=with-ã«è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³-mongoid-4167>#with ã«è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (MONGOID-4167)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rb data-lang=rb><span style=color:#66d9ef>Mongo</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Client</span><span style=color:#f92672>::</span><span style=color:#66d9ef>VALID_OPTIONS</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>Mongoid</span><span style=color:#f92672>::</span><span style=color:#66d9ef>PersistenceContext</span><span style=color:#f92672>::</span><span style=color:#66d9ef>EXTRA_OPTIONS</span>
<span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span><span style=color:#e6db74>:app_name</span>,
 <span style=color:#e6db74>:auth_mech</span>,
 <span style=color:#e6db74>:auth_mech_properties</span>,
 <span style=color:#e6db74>:auth_source</span>,
 <span style=color:#e6db74>:connect</span>,
 <span style=color:#e6db74>:connect_timeout</span>,
 <span style=color:#e6db74>:compressors</span>,
 <span style=color:#e6db74>:database</span>,
 <span style=color:#e6db74>:heartbeat_frequency</span>,
 <span style=color:#e6db74>:id_generator</span>,
 <span style=color:#e6db74>:local_threshold</span>,
 <span style=color:#e6db74>:logger</span>,
 <span style=color:#e6db74>:max_idle_time</span>,
 <span style=color:#e6db74>:max_pool_size</span>,
 <span style=color:#e6db74>:max_read_retries</span>,
 <span style=color:#e6db74>:min_pool_size</span>,
 <span style=color:#e6db74>:monitoring</span>,
 <span style=color:#e6db74>:password</span>,
 <span style=color:#e6db74>:platform</span>,
 <span style=color:#e6db74>:read</span>,
 <span style=color:#e6db74>:read_concern</span>,
 <span style=color:#e6db74>:read_retry_interval</span>,
 <span style=color:#e6db74>:replica_set</span>,
 <span style=color:#e6db74>:retry_writes</span>,
 <span style=color:#e6db74>:server_selection_timeout</span>,
 <span style=color:#e6db74>:socket_timeout</span>,
 <span style=color:#e6db74>:ssl</span>,
 <span style=color:#e6db74>:ssl_ca_cert</span>,
 <span style=color:#e6db74>:ssl_ca_cert_string</span>,
 <span style=color:#e6db74>:ssl_ca_cert_object</span>,
 <span style=color:#e6db74>:ssl_cert</span>,
 <span style=color:#e6db74>:ssl_cert_string</span>,
 <span style=color:#e6db74>:ssl_cert_object</span>,
 <span style=color:#e6db74>:ssl_key</span>,
 <span style=color:#e6db74>:ssl_key_string</span>,
 <span style=color:#e6db74>:ssl_key_object</span>,
 <span style=color:#e6db74>:ssl_key_pass_phrase</span>,
 <span style=color:#e6db74>:ssl_verify</span>,
 <span style=color:#e6db74>:truncate_logs</span>,
 <span style=color:#e6db74>:user</span>,
 <span style=color:#e6db74>:wait_queue_timeout</span>,
 <span style=color:#e6db74>:write</span>,
 <span style=color:#e6db74>:zlib_compression_level</span>,
 <span style=color:#e6db74>:client</span>,
 <span style=color:#e6db74>:collection</span><span style=color:#f92672>]</span>
</code></pre></div><h2 id=first_or_initialize-ã®æŒ™å‹•ã®å¤‰æ›´-mongoid-4193>first_or_initialize ã®æŒ™å‹•ã®å¤‰æ›´ (MONGOID-4193)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rb data-lang=rb><span style=color:#66d9ef>User</span><span style=color:#f92672>.</span>where(name: <span style=color:#e6db74>&#39;ren&#39;</span>)<span style=color:#f92672>.</span>exists? <span style=color:#75715e># =&gt; false</span>

u <span style=color:#f92672>=</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>.</span>where(name: <span style=color:#e6db74>&#39;ren&#39;</span>)<span style=color:#f92672>.</span>first_or_initialize(<span style=color:#e6db74>n</span>: <span style=color:#e6db74>&#39;pitohui&#39;</span>)

<span style=color:#75715e># mongoid 5.x</span>
u<span style=color:#f92672>.</span>name <span style=color:#75715e># =&gt; ren</span>

<span style=color:#75715e># mongoid 6.0.0</span>
u<span style=color:#f92672>.</span>name <span style=color:#75715e># =&gt; pitohui</span>
</code></pre></div><p>ğŸ“ <code>first_or_initialize</code> ã«æ¸¡ã™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯ä½¿ãˆãªã„</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rb data-lang=rb>u <span style=color:#f92672>=</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>.</span>where(name: <span style=color:#e6db74>&#39;ren&#39;</span>),first_or_initialize(name: <span style=color:#e6db74>&#39;pitohui&#39;</span>)
u<span style=color:#f92672>.</span>name <span style=color:#75715e># =&gt; ren</span>

<span style=color:#75715e># &#39;pitohui&#39; ã§åˆæœŸåŒ–ã•ã‚Œãªã„</span>
</code></pre></div><h2 id=field-relation-name-ã«ä½¿ãˆãªã„åå‰-mongoid-4239>field, relation name ã«ä½¿ãˆãªã„åå‰ (MONGOID-4239)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rb data-lang=rb><span style=color:#75715e># mongoid v6.1.1 ã®çµæœ</span>
<span style=color:#66d9ef>Mongoid</span><span style=color:#f92672>.</span>destructive_fields
<span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span><span style=color:#e6db74>:flagged_destroys</span>,
 <span style=color:#e6db74>:add_atomic_pull</span>,
 <span style=color:#e6db74>:add_atomic_unset</span>,
 <span style=color:#e6db74>:delayed_atomic_sets</span>,
 <span style=color:#e6db74>:atomic_path</span>,
 <span style=color:#e6db74>:atomic_array_pushes</span>,
 <span style=color:#e6db74>:atomic_array_pulls</span>,
 <span style=color:#e6db74>:atomic_array_add_to_sets</span>,
 <span style=color:#e6db74>:atomic_pulls</span>,
 <span style=color:#e6db74>:delayed_atomic_pulls</span>,
 <span style=color:#e6db74>:delayed_atomic_unsets</span>,
 <span style=color:#e6db74>:atomic_attribute_name</span>,
 <span style=color:#e6db74>:atomic_position</span>,
 <span style=color:#e6db74>:atomic_updates</span>,
 <span style=color:#e6db74>:process_flagged_destroys</span>,
 <span style=color:#e6db74>:_updates</span>,
 <span style=color:#e6db74>:atomic_delete_modifier</span>,
 <span style=color:#e6db74>:atomic_paths</span>,
 <span style=color:#e6db74>:atomic_insert_modifier</span>,
 <span style=color:#e6db74>:flag_as_destroyed</span>,
 <span style=color:#e6db74>:atomic_pushes</span>,
 <span style=color:#e6db74>:atomic_sets</span>,
 <span style=color:#e6db74>:atomic_unsets</span>,
 <span style=color:#e6db74>:[]</span>,
 <span style=color:#e6db74>:[]</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:attributes</span>,
 <span style=color:#e6db74>:attributes</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:has_attribute?</span>,
 <span style=color:#e6db74>:read_attribute</span>,
 <span style=color:#e6db74>:attribute_present?</span>,
 <span style=color:#e6db74>:write_attribute</span>,
 <span style=color:#e6db74>:remove_attribute</span>,
 <span style=color:#e6db74>:assign_attributes</span>,
 <span style=color:#e6db74>:raw_attributes</span>,
 <span style=color:#e6db74>:attributes_before_type_cast</span>,
 <span style=color:#e6db74>:has_attribute_before_type_cast?</span>,
 <span style=color:#e6db74>:attribute_missing?</span>,
 <span style=color:#e6db74>:read_attribute_before_type_cast</span>,
 <span style=color:#e6db74>:write_attributes</span>,
 <span style=color:#e6db74>:typed_attributes</span>,
 <span style=color:#e6db74>:process_attributes</span>,
 <span style=color:#e6db74>:clone</span>,
 <span style=color:#e6db74>:dup</span>,
 <span style=color:#e6db74>:changed</span>,
 <span style=color:#e6db74>:changes</span>,
 <span style=color:#e6db74>:changed?</span>,
 <span style=color:#e6db74>:changed_attributes</span>,
 <span style=color:#e6db74>:remove_change</span>,
 <span style=color:#e6db74>:post_persist</span>,
 <span style=color:#e6db74>:setters</span>,
 <span style=color:#e6db74>:move_changes</span>,
 <span style=color:#e6db74>:children_changed?</span>,
 <span style=color:#e6db74>:previous_changes</span>,
 <span style=color:#e6db74>:__evolve_object_id__</span>,
 <span style=color:#e6db74>:attribute_names</span>,
 <span style=color:#e6db74>:apply_defaults</span>,
 <span style=color:#e6db74>:apply_pre_processed_defaults</span>,
 <span style=color:#e6db74>:apply_post_processed_defaults</span>,
 <span style=color:#e6db74>:using_object_ids?</span>,
 <span style=color:#e6db74>:database_field_name</span>,
 <span style=color:#e6db74>:apply_default</span>,
 <span style=color:#e6db74>:lazy_settable?</span>,
 <span style=color:#e6db74>:inspect</span>,
 <span style=color:#e6db74>:run_callbacks</span>,
 <span style=color:#e6db74>:run_before_callbacks</span>,
 <span style=color:#e6db74>:run_after_callbacks</span>,
 <span style=color:#e6db74>:callback_executable?</span>,
 <span style=color:#e6db74>:in_callback_state?</span>,
 <span style=color:#e6db74>:_matches?</span>,
 <span style=color:#e6db74>:atomically</span>,
 <span style=color:#e6db74>:fail_due_to_validation!</span>,
 <span style=color:#e6db74>:fail_due_to_callback!</span>,
 <span style=color:#e6db74>:hasherizer</span>,
 <span style=color:#e6db74>:upsert</span>,
 <span style=color:#e6db74>:update</span>,
 <span style=color:#e6db74>:update_attribute</span>,
 <span style=color:#e6db74>:update_attributes</span>,
 <span style=color:#e6db74>:update!</span>,
 <span style=color:#e6db74>:update_attributes!</span>,
 <span style=color:#e6db74>:save</span>,
 <span style=color:#e6db74>:save!</span>,
 <span style=color:#e6db74>:positionally</span>,
 <span style=color:#e6db74>:__metadata</span>,
 <span style=color:#e6db74>:relation_metadata</span>,
 <span style=color:#e6db74>:embedded?</span>,
 <span style=color:#e6db74>:embedded_many?</span>,
 <span style=color:#e6db74>:embedded_one?</span>,
 <span style=color:#e6db74>:metadata_name</span>,
 <span style=color:#e6db74>:referenced_many?</span>,
 <span style=color:#e6db74>:referenced_one?</span>,
 <span style=color:#e6db74>:reload_relations</span>,
 <span style=color:#e6db74>:__metadata</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:reload</span>,
 <span style=color:#e6db74>:serializable_hash</span>,
 <span style=color:#e6db74>:shard_key_fields</span>,
 <span style=color:#e6db74>:shard_key_selector</span>,
 <span style=color:#e6db74>:persisted?</span>,
 <span style=color:#e6db74>:new_record?</span>,
 <span style=color:#e6db74>:destroyed?</span>,
 <span style=color:#e6db74>:readonly?</span>,
 <span style=color:#e6db74>:marked_for_destruction?</span>,
 <span style=color:#e6db74>:flagged_for_destroy</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:new_record</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:destroyed</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:pushable?</span>,
 <span style=color:#e6db74>:updateable?</span>,
 <span style=color:#e6db74>:settable?</span>,
 <span style=color:#e6db74>:flagged_for_destroy?</span>,
 <span style=color:#e6db74>:cache_key</span>,
 <span style=color:#e6db74>:_children</span>,
 <span style=color:#e6db74>:_parent</span>,
 <span style=color:#e6db74>:_root</span>,
 <span style=color:#e6db74>:parentize</span>,
 <span style=color:#e6db74>:_reset_memoized_children!</span>,
 <span style=color:#e6db74>:collect_children</span>,
 <span style=color:#e6db74>:remove_child</span>,
 <span style=color:#e6db74>:hereditary?</span>,
 <span style=color:#e6db74>:reset_persisted_children</span>,
 <span style=color:#e6db74>:flag_children_persisted</span>,
 <span style=color:#e6db74>:_parent</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:_root?</span>,
 <span style=color:#e6db74>:valid?</span>,
 <span style=color:#e6db74>:read_attribute_for_validation</span>,
 <span style=color:#e6db74>:begin_validate</span>,
 <span style=color:#e6db74>:exit_validate</span>,
 <span style=color:#e6db74>:validated?</span>,
 <span style=color:#e6db74>:performing_validations?</span>,
 <span style=color:#e6db74>:validating_with_query?</span>,
 <span style=color:#e6db74>:&lt;</span><span style=color:#f92672>=&gt;</span>,
 <span style=color:#e6db74>:==</span>,
 <span style=color:#e6db74>:==</span><span style=color:#f92672>=</span>,
 <span style=color:#e6db74>:eql?</span>,
 <span style=color:#e6db74>:_synced</span>,
 <span style=color:#e6db74>:_syncable?</span>,
 <span style=color:#e6db74>:_synced?</span>,
 <span style=color:#e6db74>:remove_inverse_keys</span>,
 <span style=color:#e6db74>:update_inverse_keys</span>,
 <span style=color:#e6db74>:persisted?</span>,
 <span style=color:#e6db74>:assign_attributes</span>,
 <span style=color:#e6db74>:sanitize_for_mass_assignment</span>,
 <span style=color:#e6db74>:sanitize_forbidden_attributes</span>,
 <span style=color:#e6db74>:valid?</span>,
 <span style=color:#e6db74>:validate</span>,
 <span style=color:#e6db74>:errors</span>,
 <span style=color:#e6db74>:validate!</span>,
 <span style=color:#e6db74>:read_attribute_for_validation</span>,
 <span style=color:#e6db74>:invalid?</span>,
 <span style=color:#e6db74>:validates_with</span>,
 <span style=color:#e6db74>:run_validations!</span>,
 <span style=color:#e6db74>:raise_validation_error</span>,
 <span style=color:#e6db74>:==</span>,
 <span style=color:#e6db74>:options</span>,
 <span style=color:#e6db74>:collection</span>,
 <span style=color:#e6db74>:client</span>,
 <span style=color:#e6db74>:cluster</span>,
 <span style=color:#e6db74>:database_name</span>,
 <span style=color:#e6db74>:collection_name</span>,
 <span style=color:#e6db74>:storage_options</span>,
 <span style=color:#e6db74>:to_json</span>,
 <span style=color:#e6db74>:`</span>,
 <span style=color:#e6db74>:methods</span>,
 <span style=color:#e6db74>:singleton_methods</span>,
 <span style=color:#e6db74>:protected_methods</span>,
 <span style=color:#e6db74>:private_methods</span>,
 <span style=color:#e6db74>:public_methods</span>,
 <span style=color:#e6db74>:to_yaml</span>,
 <span style=color:#e6db74>:to_yaml_properties</span>,
 <span style=color:#e6db74>:blank?</span>,
 <span style=color:#e6db74>:presence</span>,
 <span style=color:#e6db74>:present?</span>,
 <span style=color:#e6db74>:psych_to_yaml</span>,
 <span style=color:#e6db74>:as_json</span>,
 <span style=color:#e6db74>:acts_like?</span>,
 <span style=color:#e6db74>:to_param</span>,
 <span style=color:#e6db74>:to_query</span>,
 <span style=color:#e6db74>:deep_dup</span>,
 <span style=color:#e6db74>:duplicable?</span>,
 <span style=color:#e6db74>:in?</span>,
 <span style=color:#e6db74>:presence_in</span>,
 <span style=color:#e6db74>:instance_values</span>,
 <span style=color:#e6db74>:instance_variable_names</span>,
 <span style=color:#e6db74>:with_options</span>,
 <span style=color:#e6db74>:html_safe?</span>,
 <span style=color:#e6db74>:pry</span>,
 <span style=color:#e6db74>:__binding__</span>,
 <span style=color:#e6db74>:dclone</span>,
 <span style=color:#e6db74>:require_dependency</span>,
 <span style=color:#e6db74>:unloadable</span>,
 <span style=color:#e6db74>:require_or_load</span>,
 <span style=color:#e6db74>:load_dependency</span>,
 <span style=color:#e6db74>:__array__</span>,
 <span style=color:#e6db74>:__deep_copy__</span>,
 <span style=color:#e6db74>:__add__</span>,
 <span style=color:#e6db74>:__add_from_array__</span>,
 <span style=color:#e6db74>:__intersect__</span>,
 <span style=color:#e6db74>:__intersect_from_object__</span>,
 <span style=color:#e6db74>:__intersect_from_array__</span>,
 <span style=color:#e6db74>:__union__</span>,
 <span style=color:#e6db74>:__union_from_object__</span>,
 <span style=color:#e6db74>:__expand_complex__</span>,
 <span style=color:#e6db74>:regexp?</span>,
 <span style=color:#e6db74>:ivar</span>,
 <span style=color:#e6db74>:__evolve_object_id__</span>,
 <span style=color:#e6db74>:__find_args__</span>,
 <span style=color:#e6db74>:__mongoize_object_id__</span>,
 <span style=color:#e6db74>:__mongoize_time__</span>,
 <span style=color:#e6db74>:blank_criteria?</span>,
 <span style=color:#e6db74>:multi_arged?</span>,
 <span style=color:#e6db74>:resizable?</span>,
 <span style=color:#e6db74>:mongoize</span>,
 <span style=color:#e6db74>:__to_inc__</span>,
 <span style=color:#e6db74>:numeric?</span>,
 <span style=color:#e6db74>:__sortable__</span>,
 <span style=color:#e6db74>:__setter__</span>,
 <span style=color:#e6db74>:do_or_do_not</span>,
 <span style=color:#e6db74>:remove_ivar</span>,
 <span style=color:#e6db74>:substitutable</span>,
 <span style=color:#e6db74>:you_must</span>,
 <span style=color:#e6db74>:to_bson_key</span>,
 <span style=color:#e6db74>:to_bson_normalized_value</span>,
 <span style=color:#e6db74>:to_bson_normalized_key</span>,
 <span style=color:#e6db74>:pretty_print</span>,
 <span style=color:#e6db74>:pretty_print_cycle</span>,
 <span style=color:#e6db74>:pretty_print_instance_variables</span>,
 <span style=color:#e6db74>:pretty_print_inspect</span>,
 <span style=color:#e6db74>:to_ruby</span>,
 <span style=color:#e6db74>:to_v8</span>,
 <span style=color:#e6db74>:try</span>,
 <span style=color:#e6db74>:try!</span>,
 <span style=color:#e6db74>:tap</span>,
 <span style=color:#e6db74>:public_send</span>,
 <span style=color:#e6db74>:instance_variables</span>,
 <span style=color:#e6db74>:instance_variable_set</span>,
 <span style=color:#e6db74>:instance_variable_defined?</span>,
 <span style=color:#e6db74>:remove_instance_variable</span>,
 <span style=color:#e6db74>:kind_of?</span>,
 <span style=color:#e6db74>:is_a?</span>,
 <span style=color:#e6db74>:instance_variable_get</span>,
 <span style=color:#e6db74>:instance_of?</span>,
 <span style=color:#e6db74>:class_eval</span>,
 <span style=color:#e6db74>:public_method</span>,
 <span style=color:#e6db74>:extend</span>,
 <span style=color:#e6db74>:define_singleton_method</span>,
 <span style=color:#e6db74>:singleton_method</span>,
 <span style=color:#e6db74>:to_enum</span>,
 <span style=color:#e6db74>:enum_for</span>,
 <span style=color:#e6db74>:suppress_warnings</span>,
 <span style=color:#e6db74>:&lt;</span><span style=color:#f92672>=&gt;</span>,
 <span style=color:#e6db74>:==</span><span style=color:#f92672>=</span>,
 :<span style=color:#f92672>=~</span>,
 :<span style=color:#f92672>!~</span>,
 <span style=color:#e6db74>:eql?</span>,
 <span style=color:#e6db74>:respond_to?</span>,
 <span style=color:#e6db74>:freeze</span>,
 <span style=color:#e6db74>:inspect</span>,
 <span style=color:#e6db74>:display</span>,
 <span style=color:#e6db74>:ai</span>,
 <span style=color:#e6db74>:object_id</span>,
 <span style=color:#e6db74>:send</span>,
 <span style=color:#e6db74>:to_s</span>,
 <span style=color:#e6db74>:gem</span>,
 <span style=color:#e6db74>:pretty_inspect</span>,
 <span style=color:#e6db74>:awesome_inspect</span>,
 <span style=color:#e6db74>:awesome_print</span>,
 <span style=color:#e6db74>:byebug</span>,
 <span style=color:#e6db74>:debugger</span>,
 <span style=color:#e6db74>:method</span>,
 <span style=color:#e6db74>:nil?</span>,
 <span style=color:#e6db74>:hash</span>,
 <span style=color:#e6db74>:class</span>,
 <span style=color:#e6db74>:singleton_class</span>,
 <span style=color:#e6db74>:clone</span>,
 <span style=color:#e6db74>:dup</span>,
 <span style=color:#e6db74>:itself</span>,
 <span style=color:#e6db74>:taint</span>,
 <span style=color:#e6db74>:tainted?</span>,
 <span style=color:#e6db74>:untaint</span>,
 <span style=color:#e6db74>:untrust</span>,
 <span style=color:#e6db74>:trust</span>,
 <span style=color:#e6db74>:untrusted?</span>,
 <span style=color:#e6db74>:frozen?</span>,
 :<span style=color:#f92672>!</span>,
 :<span style=color:#f92672>!=</span>,
 <span style=color:#e6db74>:__send__</span>,
 <span style=color:#e6db74>:equal?</span>,
 <span style=color:#e6db74>:instance_eval</span>,
 <span style=color:#e6db74>:instance_exec</span>,
 <span style=color:#e6db74>:__id__</span>,
 <span style=color:#e6db74>:fields</span>,
 <span style=color:#e6db74>:aliased_fields</span>,
 <span style=color:#e6db74>:localized_fields</span>,
 <span style=color:#e6db74>:index_specifications</span>,
 <span style=color:#e6db74>:shard_key_fields</span>,
 <span style=color:#e6db74>:nested_attributes</span>,
 <span style=color:#e6db74>:readonly_attributes</span>,
 <span style=color:#e6db74>:storage_options</span>,
 <span style=color:#e6db74>:cascades</span>,
 <span style=color:#e6db74>:cyclic</span>,
 <span style=color:#e6db74>:cache_timestamp_format</span><span style=color:#f92672>]</span>
</code></pre></div><p>v6.1.0 ã§ Mongoid::PersistenceContext ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚äºˆç´„èªã«è¿½åŠ ã•ã‚ŒãŸã“ã¨ã§äºˆç´„èªãŒï¼’å€ã«
<a href=https://github.com/mongodb/mongoid/blob/6.1.0-stable/lib/mongoid/composable.rb#L88>https://github.com/mongodb/mongoid/blob/6.1.0-stable/lib/mongoid/composable.rb#L88</a></p><p>v6.4.0 ã§ã¯ Mongoid::Clients::Options ãŒè¿½åŠ ã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ãŒäºˆç´„èªã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹
<code>[:with, :collection, :collection_name, :persistence_context, :mongo_client]</code></p><h2 id=600rc0>6.0.0.rc0</h2><p><a href=https://github.com/mongodb/mongoid/releases/tag/v6.0.0.rc0>https://github.com/mongodb/mongoid/releases/tag/v6.0.0.rc0</a></p><ul><li><a href=https://jira.mongodb.org/browse/MONGOID-4052 target=_blank>MONGOID-4052</a> #only and #without methods are not scoped to specific locales, unless user explicitly does so.<ul><li><code>#only</code> , <code>#without</code> ãƒ¡ã‚½ãƒƒãƒ‰ã« localize ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¿½åŠ </li><li><a href=https://github.com/mongodb/mongoid/pull/4277>https://github.com/mongodb/mongoid/pull/4277</a></li></ul></li><li>Criteria#map uses <code>#pluck</code>, not <code>#only</code></li></ul><h2 id=600>6.0.0</h2><p><a href=https://github.com/mongodb/mongoid/releases/tag/v6.0.0>https://github.com/mongodb/mongoid/releases/tag/v6.0.0</a></p><ul><li>MONGOID-4173 [https://jira.mongodb.org/browse/MONGOID-4173] Fix nested eager loading. * v5.1.0 ã§ã‚‚ä¿®æ­£æ¸ˆã¿</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rb data-lang=rb>article <span style=color:#f92672>=</span> <span style=color:#66d9ef>Article</span><span style=color:#f92672>.</span>includes(<span style=color:#e6db74>user</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>:blog</span><span style=color:#f92672>]</span>)<span style=color:#f92672>.</span>first
<span style=color:#66d9ef>MONGODB</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>localhost</span>:<span style=color:#ae81ff>27017</span> <span style=color:#f92672>|</span> blog_development<span style=color:#f92672>.</span>find <span style=color:#f92672>|</span> <span style=color:#66d9ef>STARTED</span> <span style=color:#f92672>|</span> {<span style=color:#e6db74>&#34;find&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#34;articles&#34;</span>, <span style=color:#e6db74>&#34;filter&#34;</span><span style=color:#f92672>=&gt;</span>{}, <span style=color:#e6db74>&#34;limit&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;singleBatch&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#66d9ef>true</span>}
<span style=color:#66d9ef>MONGODB</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>localhost</span>:<span style=color:#ae81ff>27017</span> <span style=color:#f92672>|</span> blog_development<span style=color:#f92672>.</span>find <span style=color:#f92672>|</span> <span style=color:#66d9ef>STARTED</span> <span style=color:#f92672>|</span> {<span style=color:#e6db74>&#34;find&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#34;users&#34;</span>, <span style=color:#e6db74>&#34;filter&#34;</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>&#34;_id&#34;</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>&#34;$in&#34;</span><span style=color:#f92672>=&gt;[</span><span style=color:#66d9ef>BSON</span><span style=color:#f92672>::</span><span style=color:#66d9ef>ObjectId</span>(<span style=color:#e6db74>&#39;5c198c15611e57086a751514&#39;</span>)<span style=color:#f92672>]</span>}}}
<span style=color:#66d9ef>MONGODB</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>localhost</span>:<span style=color:#ae81ff>27017</span> <span style=color:#f92672>|</span> blog_development<span style=color:#f92672>.</span>find <span style=color:#f92672>|</span> <span style=color:#66d9ef>STARTED</span> <span style=color:#f92672>|</span> {<span style=color:#e6db74>&#34;find&#34;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#34;blogs&#34;</span>, <span style=color:#e6db74>&#34;filter&#34;</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>&#34;_id&#34;</span><span style=color:#f92672>=&gt;</span>{<span style=color:#e6db74>&#34;$in&#34;</span><span style=color:#f92672>=&gt;[</span><span style=color:#66d9ef>BSON</span><span style=color:#f92672>::</span><span style=color:#66d9ef>ObjectId</span>(<span style=color:#e6db74>&#39;5c198c14611e57086a751510&#39;</span>)<span style=color:#f92672>]</span>}}}
</code></pre></div></div></article><div class="license markdown-body"><blockquote><p>Unless otherwise noted, the content of this site is licensed under <a rel=license href target=_blank></a>.</p></blockquote></div></div><div class="col-md-3 col-12 float-left link-alter" id=sidebar><div class=widget-toc><h5>TOC</h5><nav id=TableOfContents><ul><li><a href=#upgrading-mongoid>Upgrading mongoid</a></li><li><a href=#600beta>6.0.0.beta</a></li><li><a href=#with-ã«è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³-mongoid-4167>#with ã«è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ (MONGOID-4167)</a></li><li><a href=#first_or_initialize-ã®æŒ™å‹•ã®å¤‰æ›´-mongoid-4193>first_or_initialize ã®æŒ™å‹•ã®å¤‰æ›´ (MONGOID-4193)</a></li><li><a href=#field-relation-name-ã«ä½¿ãˆãªã„åå‰-mongoid-4239>field, relation name ã«ä½¿ãˆãªã„åå‰ (MONGOID-4239)</a></li><li><a href=#600rc0>6.0.0.rc0</a></li><li><a href=#600>6.0.0</a></li></ul></nav></div><div class=widget-pages><h5>Pages</h5><ul><li><a href=/index.xml target=_blank>RSS</a></li></ul></div><div class=widget-tags><h5>Tags</h5><div></div></div><div class=widget-links><h5>Links</h5><ul></ul></div></div></div></main><footer><div class="container-lg text-center"><p>&copy; 2020 <a href=https://blog.mknkisk.com/></a>| Powered by <a href=https://github.com/amzrk2/hugo-theme-fuji/ target=_blank>Fuji</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></p></div></footer><script>$(function(){mediumZoom('.img-zoomable',{margin:32});});</script><script>$('.widget-toc a').click(function(){$('html, body').animate({scrollTop:$($(this).attr('href')).offset().top});});</script></body></html>